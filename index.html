<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ICF Core Competencies Quiz (68 Questions)</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --icf-blue:#30398D; --deep-blue:#001E60; --icf-gold:#FEBD3B; --cred-orange:#EA7600;
      --ok:#16a34a; --bad:#dc2626;
      --font-title:'Montserrat',ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      --font-body:'Lora',ui-serif,Georgia,Cambria,"Times New Roman",Times,serif;
    }
    html,body{height:100%} *{box-sizing:border-box}

    html[data-theme="dark"]{
      --bg1:#001e60; --bg2:#30398D; --bg3:#2c3e83;
      --card:#0b102a; --card2:#12183a; --text:#E7EAF4; --muted:#cfd5ff;
      --accent: var(--cred-orange); --accent2: var(--icf-gold);
      --surface-border: rgba(255,255,255,.12);
      --btn-bg: rgba(255,255,255,.04); --btn-bg-hover: rgba(255,255,255,.08);
      --progress-bg: rgba(255,255,255,.18);
      --chart-grid:#2b2f69; --chart-axis:#9aa3ff; --chart-text:#eef2ff;
    }

    html[data-theme="light"]{
      --bg1:#f3f5ff; --bg2:#ffffff; --bg3:#eef0ff;
      --card:#ffffff; --card2:#f7f8ff; --text:#0f172a; --muted:#334155;
      --accent: var(--icf-blue); --accent2: var(--cred-orange);
      --surface-border: rgba(0,0,0,.10);
      --btn-bg:#ffffff; --btn-bg-hover: rgba(0,0,0,.03);
      --progress-bg: rgba(15,23,42,.12);
      --chart-grid:#dbe1ff; --chart-axis:#4b5563; --chart-text:#111827;
    }

    body{
      margin:0;
      color:var(--text);
      font-family:var(--font-body);
      background-color: var(--bg1);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(48,57,141,.25), transparent),
        radial-gradient(1000px 500px at 110% 10%, rgba(254,189,59,.25), transparent),
        linear-gradient(135deg, var(--bg1), var(--bg2) 48%, var(--bg3));
      height:100vh; overflow:hidden;
      display:grid; grid-template-rows:auto 1fr auto;
    }

    header{background:rgba(0,0,0,.18); border-bottom:1px solid var(--surface-border)}
    .wrap{max-width:1100px;margin:0 auto;padding:10px 14px}
    .title{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .title h1{margin:0;font-family:var(--font-title);font-weight:800;font-size:clamp(18px,2.6vw,24px)}

    .meter{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:6px;font-size:12px}
    .badge{background:linear-gradient(180deg, var(--card2), var(--card));border:1px solid var(--surface-border);padding:6px 8px;border-radius:10px; display:flex; gap:6px; align-items:center}
    .badge b{font-weight:800;color:var(--accent2)}
    .progress{height:8px; flex:1; min-width:160px; border-radius:999px; overflow:hidden; background:var(--progress-bg)}
    .progress>span{display:block;height:100%;width:0%; background:linear-gradient(90deg, var(--accent), var(--accent2)); transition:width .35s ease}

    main{display:grid; place-items:center; padding:8px 10px; overflow:hidden}
    .stage{width:min(900px, 96vw); height:100%; display:flex; align-items:center; justify-content:center}

    .card{
      width:100%; height:min(70vh, 100%); overflow:hidden;
      background:linear-gradient(180deg, var(--card), var(--card2));
      border:1px solid var(--surface-border); border-radius:16px; padding:14px;
      display:grid; grid-template-rows:auto 1fr auto; gap:10px;
      box-shadow: 0 16px 44px rgba(0,0,0,.18);
    }

    .q-head{display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap}
    .q-index{font-size:12px; color:var(--muted); letter-spacing:.2px}
    .question{font-size:clamp(16px,2.2vw,20px);line-height:1.28}

    #options{display:flex;flex-direction:column;gap:8px;}
    .btn{text-align:left; border:1px solid var(--surface-border);background:var(--btn-bg); color:var(--text);
      padding:10px 12px; border-radius:10px; cursor:pointer;font-size:clamp(14px,1.9vw,17px);}
    .btn:hover{transform:translateY(-1px); background:var(--btn-bg-hover)}
    .btn.correct{font-weight:800;border-color:rgba(22,163,74,.6);background:linear-gradient(180deg, rgba(22,163,74,.28), rgba(22,163,74,.14))}
    .btn.wrong{font-weight:800;border-color:rgba(220,38,38,.6);background:linear-gradient(180deg, rgba(220,38,38,.28), rgba(220,38,38,.14))}
    .btn.disabled{pointer-events:none; opacity:.95}

    .pill{font-weight:800; letter-spacing:.2px;background:#fff; padding:6px 8px;border-radius:999px;border:1px solid var(--surface-border); color:#111}
    .nav{display:flex; justify-content:flex-end}
    .action{border:0; padding:10px 16px; border-radius:10px;background:linear-gradient(90deg, var(--accent), var(--accent2)); color:#111827; font-weight:900; cursor:pointer; box-shadow:0 8px 18px rgba(0,0,0,.25)}
    .action.ghost{background:linear-gradient(180deg, var(--card2), var(--card)); border:1px solid var(--surface-border); color:var(--text); box-shadow:none}

    footer{background: rgba(0,0,0,.18); border-top:1px solid var(--surface-border)}
    .footbar{display:flex;align-items:center;justify-content:space-between;gap:12px
      position:relative;
    }

    html[data-theme="dark"] #answered.pill,
    html[data-theme="dark"] footer .pill{
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color: #111827; border:0; box-shadow: 0 8px 18px rgba(0,0,0,.35);
    }

    #resultModal{display:none}
    #resultModal.show{display:flex; position:fixed; inset:0; align-items:center; justify-content:center;background: rgba(0,0,0,.6); padding:12px;}
    #resultModal .panel{
      max-width:980px; width:92%;
      padding:16px 14px; border-radius:16px;
      background:linear-gradient(180deg, var(--card), var(--card2)); border:1px solid var(--surface-border);
      box-shadow: 0 30px 80px rgba(0,0,0,.5);
      color:var(--text);
      max-height:86vh; overflow:auto;
      display:flex; flex-direction:column; gap:12px;
      text-align:left;
    }
    #resultModal h2{margin:0; font-family:var(--font-title); font-weight:900; font-size:clamp(18px,2.4vw,26px); text-align:center}
    #resultScore{ text-align:center }
    .grid2{display:grid; grid-template-columns:1fr; gap:12px}
    @media (min-width: 860px){ .grid2{grid-template-columns: 1.1fr .9fr;} }

    .panelCard{
      border:1px solid var(--surface-border);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-radius:14px;
      padding:12px;
    }
    .panelCard h3{margin:0 0 10px 0; font-family:var(--font-title); font-size:16px; letter-spacing:.2px}

    .barRow{display:grid; grid-template-columns: 1fr 90px; gap:10px; align-items:center; padding:7px 0; border-top:1px dashed rgba(255,255,255,.12)}
    .barRow:first-child{border-top:0}
    .barLabel{font-size:13px; color:var(--muted); margin-bottom:6px}
    .barWrap{height:10px; border-radius:999px; background:rgba(255,255,255,.10); overflow:hidden}
    .barFill{height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent2)); transition:width .6s ease}
    .barPct{font-family:var(--font-title); font-weight:900; text-align:right}

    .miniLegend{display:flex; gap:10px; flex-wrap:wrap; font-size:12px; color:var(--muted)}
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block; background:linear-gradient(90deg, var(--accent), var(--accent2)); margin-right:6px; vertical-align:middle}
    .resultActions{display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap}

    /* --- Welcome screen --- */
    .welcomeBox{
      height:100%;
      display:flex;
      position:relative;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:10px 14px;
      padding-bottom:90px;
      gap:14px;
    }
    .welcomeBox h2{
      margin:0;
      font-family:var(--font-title);
      font-weight:900;
      font-size:clamp(26px,4vw,38px);
      letter-spacing:.2px;
    }
    .welcomeBox .wtext{
      max-width:760px;
      font-size:clamp(14px,2vw,18px);
      line-height:1.5;
      color:var(--muted);
      text-align:justify;
    }
    .welcomeBox .wcredit{
      position:absolute;
      left:50%;
      bottom:12px;
      transform:translateX(-50%);
      text-align:center;
      width:100%;
      font-size:clamp(13px,1.6vw,16px);
      color:var(--muted);
    }
    .welcomeBox .wcredit a{
      color:inherit;
      text-decoration:underline;
    }
    .welcomeBox .wcredit a:hover{ text-decoration:underline; }
    .welcomeBox .wcta{
      margin-top:10px;
      margin-bottom:26px; /* keep distance from footer */
      display:flex;
      justify-content:center;
      width:100%;
    }

    /* Welcome footer center credit aligned with footer labels */
    #welcomeCreditFooter{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      display:none;
      align-items:center;
      gap:6px;
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
      pointer-events:auto;
    }
    #welcomeCreditFooter a{
      color:inherit;
      text-decoration:underline;
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <h1>Self‚ÄëAssessment Quiz ‚Äî ICF Core Competencies (68 questions)</h1>
      </div>
      <div class="meter">
        <div class="badge">‚úÖ Correct: <b id="good">0</b></div>
        <div class="badge">‚ùå Incorrect: <b id="bad">0</b></div>
        <div class="badge">üìä Score: <b id="pct">0%</b></div>
        <div class="progress"><span id="prog"></span></div>
      </div>
    </div>
  </header>

  <main>
    <div class="stage">
      <article class="card">
        <div>
          <div class="q-head">
            <div class="q-index" id="qIndex">Question 1 of 68</div>
            <div class="pill" id="answered">0 / 68 answers</div>
          </div>
          <div class="question" id="questionText">...</div>
        </div>
        <div class="opts" id="options"></div>
        <div class="nav"><button class="action" id="nextBtn" disabled>NEXT</button></div>
      </article>
    </div>
  </main>

  <footer>
    <div class="wrap footbar">
      <div class="left"><span class="pill">Passing score: <b>‚â• 80%</b></span></div>
      <button class="action" id="finishBtn">FINISH QUIZ</button>
    </div>
  </footer>

  <section class="modal" id="resultModal">
    <div class="panel">
      <h2 id="resultTitle"></h2>
      <div id="resultScore" style="font-size:16px; opacity:.9;"></div>

      <div class="grid2">
        <div class="panelCard">
          <h3>üìä Chart by Core Competency</h3>
          <div class="miniLegend"><span><span class="dot"></span>% correct answers by competency</span></div>
          <div id="coreBars"></div>
        </div>

        <div class="panelCard">
          <h3>üìå Summary</h3>
          <div id="summaryBox" style="font-size:14px; line-height:1.5; color:var(--muted)"></div>
        </div>
      </div>

      <div class="resultActions">
        <button class="action ghost" id="restartBtn">RESTART</button>
        <button class="action" id="closeBtn">EXIT</button>
      </div>
    </div>
  </section>

  <script>
  (function(){
    const CORE=[
      "Demonstrates Ethical Practice",
      "Embodies a Coaching Mindset",
      "Establishes and Maintains Agreements",
      "Cultivates Trust and Safety",
      "Maintains Presence",
      "Listens Actively",
      "Evokes Awareness",
      "Facilitates Client Growth"
    ];

    // Dataset 68: as provided by you (do not translate these strings)
    const SUB=[
      ["Demonstrates personal integrity and honesty in interactions with clients, sponsors, and relevant stakeholders.","Demonstrates Ethical Practice"],
      ["Is sensitive to client's identity, environment, experiences, values, and beliefs.","Demonstrates Ethical Practice"],
      ["Uses language that is appropriate and respectful to clients, sponsors, and relevant stakeholders.","Demonstrates Ethical Practice"],
      ["Abides by the ICF Code of Ethics and upholds the ICF Core Values.","Demonstrates Ethical Practice"],
      ["Maintains confidentiality of client information per stakeholder agreements and pertinent laws.","Demonstrates Ethical Practice"],
      ["Maintains the distinctions between coaching, consulting, psychotherapy, and other support professions.","Demonstrates Ethical Practice"],
      ["Refers clients to other support professionals, as appropriate.","Demonstrates Ethical Practice"],
      ["Acknowledges that clients are responsible for their own choices.","Embodies a Coaching Mindset"],
      ["Engages in ongoing learning and development as a coach, including remaining aware of current coaching best practices and the use of technology.","Embodies a Coaching Mindset"],
      ["Develops an ongoing reflective practice to enhance one's coaching.","Embodies a Coaching Mindset"],
      ["Remains aware of and open to the influence of biases, context, and culture on self and others.","Embodies a Coaching Mindset"],
      ["Uses awareness of self and one's intuition to benefit clients.","Embodies a Coaching Mindset"],
      ["Develops and maintains the ability to manage one's emotions.","Embodies a Coaching Mindset"],
      ["Maintains emotional, physical, and mental well-being in preparation for, throughout, and following each session.","Embodies a Coaching Mindset"],
      ["Seeks help from outside sources when necessary.","Embodies a Coaching Mindset"],
      ["Nurtures openness and curiosity in oneself, the client, and the coaching process.","Embodies a Coaching Mindset"],
      ["Remains aware of the influence of one's thoughts and behaviors on the client and others.","Embodies a Coaching Mindset"],
      ["Describes one's coaching philosophy and clearly defines what coaching is and is not for potential clients and stakeholders.","Establishes and Maintains Agreements"],
      ["Reaches agreement about what is and is not appropriate in the relationship, what is and is not being offered, and the responsibilities of the client and relevant stakeholders, including commitment to working toward coaching goals.","Establishes and Maintains Agreements"],
      ["Reaches agreement about the guidelines and specific parameters of the coaching relationship such as logistics, fees, scheduling, duration, termination, confidentiality, and inclusion of others.","Establishes and Maintains Agreements"],
      ["Partners with the client and relevant stakeholders to establish an overall coaching plan and goals.","Establishes and Maintains Agreements"],
      ["Partners with the client to determine client-coach compatibility.","Establishes and Maintains Agreements"],
      ["Partners with the client to identify or reconfirm what they want to accomplish in the session.","Establishes and Maintains Agreements"],
      ["Partners with the client to define what the client believes they need to address or resolve to achieve what they want to accomplish in the session.","Establishes and Maintains Agreements"],
      ["Partners with the client to define or reconfirm measures of success for what the client wants to accomplish in the coaching engagement or individual session.","Establishes and Maintains Agreements"],
      ["Partners with the client to manage the time and focus of the session.","Establishes and Maintains Agreements"],
      ["Continues coaching in the direction of the client's desired outcome unless the client indicates otherwise.","Establishes and Maintains Agreements"],
      ["Partners with the client to close the coaching relationship in a way that respects the client and the coaching experience.","Establishes and Maintains Agreements"],
      ["Revisits the coaching agreement when necessary to ensure the coaching approach is meeting the client's needs.","Establishes and Maintains Agreements"],
      ["Seeks to understand the client within their context, which may include their identity, environment, experiences, values, and beliefs.","Cultivates Trust and Safety"],
      ["Demonstrates respect for the client's identity, perceptions, style, and language, and adapts one's coaching to the client.","Cultivates Trust and Safety"],
      ["Acknowledges and respects the client's unique talents, insights, and work in the coaching process.","Cultivates Trust and Safety"],
      ["Shows support, empathy, and concern for the client.","Cultivates Trust and Safety"],
      ["Acknowledges and supports the client's expression of feelings, perceptions, concerns, beliefs, and suggestions.","Cultivates Trust and Safety"],
      ["Demonstrates openness and transparency as a way to display vulnerability and build trust with the client.","Cultivates Trust and Safety"],
      ["Remains focused, observant, empathetic, and responsive to the client.","Maintains Presence"],
      ["Demonstrates curiosity during the coaching process.","Maintains Presence"],
      ["Remains aware of what is emerging for self and client in the present moment.","Maintains Presence"],
      ["Manages one's emotions to stay present with the client.","Maintains Presence"],
      ["Demonstrates confidence in working with strong client emotions during the coaching process.","Maintains Presence"],
      ["Is comfortable working in a space of not knowing.","Maintains Presence"],
      ["Creates or allows space for silence, pause, or reflection.","Maintains Presence"],
      ["Considers the client's context, identity, environment, experiences, values, and beliefs to enhance understanding of what the client is communicating.","Listens Actively"],
      ["Reflects or summarizes what the client is communicating to ensure clarity and understanding.","Listens Actively"],
      ["Recognizes and inquires when there is more to what the client is communicating.","Listens Actively"],
      ["Notices, acknowledges, and explores the client's emotions, energy shifts, non-verbal cues, or other behaviors.","Listens Actively"],
      ["Integrates the client's words, tone of voice, and body language to determine the full meaning of what the client is communicating.","Listens Actively"],
      ["Notices trends in the client's behaviors and emotions across sessions to discern themes and patterns.","Listens Actively"],
      ["Considers the client's experience when deciding what might be most useful.","Evokes Awareness"],
      ["Challenges the client as a way to evoke awareness or insight.","Evokes Awareness"],
      ["Asks questions about the client, such as their way of thinking, values, needs, wants, and beliefs.","Evokes Awareness"],
      ["Asks questions that help the client explore beyond current thinking.","Evokes Awareness"],
      ["Invites the client to share more about their experience in the moment.","Evokes Awareness"],
      ["Notices what is working to enhance client progress.","Evokes Awareness"],
      ["Adjusts the coaching approach in response to the client's needs.","Evokes Awareness"],
      ["Helps the client identify factors that influence current and future patterns of behavior, thinking, or emotion.","Evokes Awareness"],
      ["Invites the client to generate ideas about how they can move forward and what they are willing or able to do.","Evokes Awareness"],
      ["Supports the client in reframing perspectives.","Evokes Awareness"],
      ["Shares observations, knowledge, and feelings, without attachment, that have the potential to create new insights for the client.","Evokes Awareness"],
      ["Works with the client to integrate new awareness, insight, or learning into their worldview and behaviors.","Facilitates Client Growth"],
      ["Partners with the client to design goals, actions, and accountability measures that integrate and expand new learning.","Facilitates Client Growth"],
      ["Acknowledges and supports client autonomy in the design of goals, actions, and methods of accountability.","Facilitates Client Growth"],
      ["Supports the client in identifying potential results or learning from identified action steps.","Facilitates Client Growth"],
      ["Invites the client to consider how to move forward, including resources, support, and potential barriers.","Facilitates Client Growth"],
      ["Partners with the client to summarize learning and insight within or between sessions.","Facilitates Client Growth"],
      ["Partners with the client to integrate learning and sustain progress throughout the coaching engagement.","Facilitates Client Growth"],
      ["Acknowledges the client's progress and successes.","Facilitates Client Growth"],
      ["Partners with the client to close the session.","Facilitates Client Growth"]
    ];

    const $=id=>document.getElementById(id);
    const qIndex=$("qIndex"), qText=$("questionText"), optsBox=$("options"),
          nextBtn=$("nextBtn"), goodEl=$("good"), badEl=$("bad"),
          pctEl=$("pct"), progEl=$("prog"), ansEl=$("answered"),
          finishBtn=$("finishBtn"), modal=$("resultModal"),
          coreBars=$("coreBars"), summaryBox=$("summaryBox"),
          restartBtn=$("restartBtn"), closeBtn=$("closeBtn");

    // --- Welcome screen state ---
    let welcome=true;

    function renderWelcome(){
      // disable finishing before starting
      finishBtn.disabled=true;

      // Hide footer CTA buttons; keep footer labels visible
      nextBtn.style.display="none";
      finishBtn.style.display="none";
      const wcf = document.getElementById("welcomeCreditFooter");
      if(wcf) wcf.style.display="inline-flex";

      qIndex.textContent="";
      qText.innerHTML = `
        <div class="welcomeBox">
          <h2>Welcome!</h2>
          <div class="wtext">
            <div>In this ICF Core Competencies self‚Äëassessment, you will answer 68 questions.</div>
            <div>For each question, select the ICF Core Competency that the sub‚Äëcompetency belongs to.</div>
            <div>You pass the quiz with at least 80% correct answers.</div>
            <div>At the end, you will see a summary of your results.</div>
          </div>

          <div class="wcta">
            <button class="action" id="startBtn">START QUIZ</button>
          </div>

          <div class="wcredit">
            <span>Created by Tito Bertasi</span>
            <span> (</span>
            <a href="https://www.linkedin.com/in/titobertasi1980/" target="_blank" rel="noopener noreferrer">
              Visit LinkedIn profile
            </a>
            <span>)</span>
          </div>
        </div>
      `;
      optsBox.innerHTML="";

      // wire start button
      const startBtnEl = document.getElementById("startBtn");
      if(startBtnEl){
        startBtnEl.addEventListener("click", ()=>{
          welcome=false;
          // Show footer CTAs again
          nextBtn.style.display="";
          finishBtn.style.display="";
          const wcf2 = document.getElementById("welcomeCreditFooter");
          if(wcf2) wcf2.style.display="none";
          nextBtn.textContent="NEXT";
          renderQuestion();
        }, { once:true });
      }
    }

    const shuffle=(arr)=>{const a=arr.slice();for(let i=a.length-1;i>0;i--){const j=(Math.random()*(i+1))|0;[a[i],a[j]]=[a[j],a[i]];}return a;};

    function makeQuestions(){
      const pool=shuffle(SUB.slice()); // 68 unique, no repetition
      return pool.map(([sub,core])=>{
        const options=shuffle(CORE.slice());
        return { sub, core, options, correct: options.indexOf(core) };
      });
    }

    let QUESTIONS=makeQuestions(),idx=0,good=0,bad=0,answered=0,locked=false;

    // tracking per core
    let coreTotals={}, coreGoods={};
    function initCoreStats(){
      coreTotals={}; coreGoods={};
      CORE.forEach(c=>{coreTotals[c]=0; coreGoods[c]=0;});
    }
    initCoreStats();

    function updateHUD(){
      const pct=answered?Math.round((good/answered)*100):0;
      goodEl.textContent=good; badEl.textContent=bad; pctEl.textContent=pct+"%";
      ansEl.textContent=`${answered} / ${QUESTIONS.length} answers`;
      progEl.style.width=Math.round((answered/QUESTIONS.length)*100)+"%";
    }

    function renderQuestion(){
      if(welcome){ renderWelcome(); return; }
      // ensure footer CTAs are visible
      const wcf3 = document.getElementById("welcomeCreditFooter");
      if(wcf3) wcf3.style.display="none";
      nextBtn.style.display="";
      finishBtn.style.display="";
      finishBtn.disabled=false;
      locked=false; nextBtn.disabled=true; optsBox.innerHTML="";
      const q=QUESTIONS[idx];
      qIndex.textContent=`Question ${idx+1} of ${QUESTIONS.length}`;
      qText.innerHTML=`Which ICF Core Competency does the following sub‚Äëcompetency belong to?<br><b>"${q.sub}"</b>`;
      q.options.forEach((opt,i)=>{
        const b=document.createElement("button"); b.className="btn"; b.dataset.i=i; b.textContent=opt;
        b.addEventListener("click",()=>{
          if(locked)return; locked=true;

          // count attempt for the correct core
          coreTotals[q.core]++;

          const all=optsBox.querySelectorAll(".btn"); all.forEach(x=>x.classList.add("disabled"));
          if(i===q.correct){
            b.classList.add("correct");
            good++;
            coreGoods[q.core]++;
          }else{
            b.classList.add("wrong"); bad++;
            all.forEach(x=>{ if(Number(x.dataset.i)===q.correct) x.classList.add("correct"); });
          }

          answered++; updateHUD(); nextBtn.disabled=false;
          if(idx===QUESTIONS.length-1) nextBtn.textContent="VIEW RESULTS";
        });
        optsBox.appendChild(b);
      });
    }

    function buildBars(){
      coreBars.innerHTML="";
      CORE.forEach(core=>{
        const tot=coreTotals[core]||0;
        const ok=coreGoods[core]||0;
        const pct=tot?Math.round((ok/tot)*100):0;

        const row=document.createElement("div");
        row.className="barRow";

        const left=document.createElement("div");
        const label=document.createElement("div");
        label.className="barLabel";
        label.textContent=core;
        const wrap=document.createElement("div");
        wrap.className="barWrap";
        const fill=document.createElement("div");
        fill.className="barFill";
        fill.style.width=pct+"%";
        wrap.appendChild(fill);
        left.appendChild(label);
        left.appendChild(wrap);

        const right=document.createElement("div");
        right.className="barPct";
        right.textContent=pct+"%";

        row.appendChild(left);
        row.appendChild(right);
        coreBars.appendChild(row);
      });
    }

    function finish(){
      const total=QUESTIONS.length;
      const pct=Math.round((good/total)*100);
      const title=$("resultTitle"); const score=$("resultScore");
      const passed=(pct>=80); const emoji=passed?"üòé":"üò¢";

      title.textContent = passed
        ? `${emoji} CONGRATULATIONS ‚Äî YOU PASSED WITH A SCORE OF ${pct}% ${emoji}`
        : `${emoji} TRY AGAIN ‚Äî YOUR SCORE IS ${pct}% ${emoji}`;

      score.textContent = `Correct: ${good} ‚Ä¢ Incorrect: ${bad} ‚Ä¢ Total: ${total}`;

      // --- SUMMARY: all competencies above/below the 80% threshold ---
      const stats = CORE
        .map(c => {
          const tot = coreTotals[c] || 0;
          const ok  = coreGoods[c] || 0;
          const pct = tot ? (ok / tot * 100) : 0;
          return { c, pct };
        })
        .sort((a,b) => b.pct - a.pct);

      // Strengths = all core competencies >=80
      const strengths = stats
        .filter(x => x.pct >= 80)
        .sort((a,b) => b.pct - a.pct);

      // To improve = all core competencies <80
      const toImprove = stats
        .filter(x => x.pct < 80)
        .sort((a,b) => a.pct - b.pct);

      const strengthsHTML = strengths.length
        ? `<ul style="margin:6px 0 0 18px; padding:0; color:var(--muted)">
            ${strengths.map(x => `<li><b>${x.c}</b> (${Math.round(x.pct)}%)</li>`).join("")}
           </ul>`
        : `<div style="margin-top:6px; color:var(--muted)">No core competency is ‚â• 80% (yet).</div>`;

      const improveHTML = toImprove.length
        ? `<ul style="margin:6px 0 0 18px; padding:0; color:var(--muted)">
            ${toImprove.map(x => `<li><b>${x.c}</b> (${Math.round(x.pct)}%)</li>`).join("")}
           </ul>`
        : `<div style="margin-top:6px; color:var(--muted)"><b>All</b> core competencies are ‚â• 80% ‚úÖ</div>`;

      summaryBox.innerHTML = `
        <div><b>Target:</b> ‚â• 80% ‚Äî <b>${passed ? "achieved ‚úÖ" : "not achieved ‚ùå"}</b></div>

        <div style="margin-top:10px"><b>Strengths (‚â• 80%):</b>${strengthsHTML}</div>

        <div style="margin-top:10px"><b>To strengthen (below 80%):</b>${improveHTML}</div>

        <div style="margin-top:10px">Tip: repeat the quiz until all core competencies stay consistently ‚â• 80%.</div>
      `;

      buildBars();
      modal.classList.add('show');
    }

    function restart(){
      welcome=true;
      QUESTIONS=makeQuestions();
      idx=0; good=0; bad=0; answered=0; locked=false;
      initCoreStats();
      nextBtn.textContent="NEXT";
      modal.classList.remove('show');
      updateHUD(); renderQuestion();
    }

    nextBtn.addEventListener("click",()=>{
      if(welcome){ return; }
      if(idx<QUESTIONS.length-1){ idx++; renderQuestion(); }
      else finish();
    });
    finishBtn.addEventListener("click",finish);
    restartBtn.addEventListener("click",restart);
    closeBtn.addEventListener("click",()=>{
      try { window.close(); }
      catch(e) {}
      // Fallback if the browser blocks window.close()
      window.location.href = "about:blank";
    });

    updateHUD(); renderQuestion();
  })();
  </script>
</body>
</html>
